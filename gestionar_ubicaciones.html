<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Ubicaciones</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Dependencies: React, ReactDOM, Babel, and Lucide Icons -->
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/lucide-react@latest/dist/umd/lucide-react.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827; /* bg-gray-900 */
        }
        /* Custom scrollbar for a better look */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1f2937; /* bg-gray-800 */
        }
        ::-webkit-scrollbar-thumb {
            background: #4b5563; /* bg-gray-600 */
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280; /* bg-gray-500 */
        }
        /* Style for the delete confirmation modal */
        #deleteModal {
            background-color: rgba(0, 0, 0, 0.5);
        }
    </style>
</head>
<body class="text-gray-200">

    <div id="root"></div>

    <script type="text/babel">
        // Wrap the entire application in window.onload to ensure all scripts are loaded first
        window.onload = function() {
            const { useState, useEffect, createElement } = React;

            // Helper to render Lucide icons and handle potential loading issues
            const Icon = ({ name, ...props }) => {
                // Check if the lucide library and the specific icon are available
                if (typeof lucide === 'undefined' || !lucide[name]) {
                    console.error(`Icon "${name}" not found. The icon library may not have loaded correctly.`);
                    // Return a fallback element to prevent the app from crashing
                    return <span style={{ display: 'inline-block', width: '1em', height: '1em' }}></span>;
                }
                return createElement(lucide[name], props);
            };

            // --- Main App Component ---
            function App() {
                const [locations, setLocations] = useState([]);
                const [newLocationName, setNewLocationName] = useState('');
                const [isSidebarOpen, setIsSidebarOpen] = useState(false);
                const [showDeleteModal, setShowDeleteModal] = useState(false);
                const [locationToDelete, setLocationToDelete] = useState(null);
                const API_URL = 'api/ubicaciones.php';

                // Fetch locations from the API
                const fetchLocations = async () => {
                    try {
                        const response = await fetch(API_URL);
                        const data = await response.json();
                        setLocations(data);
                    } catch (error) {
                        console.error('Error fetching locations:', error);
                    }
                };

                useEffect(() => {
                    fetchLocations();
                }, []);

                // Function to add a new location
                const handleAddLocation = async (e) => {
                    e.preventDefault();
                    if (newLocationName.trim() === '') return;
                    
                    try {
                        const response = await fetch(API_URL, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ nombre: newLocationName.trim() })
                        });
                        const result = await response.json();
                        if (result.success) {
                            setNewLocationName('');
                            fetchLocations(); // Refresh list
                        } else {
                            alert('Error: ' + result.message);
                        }
                    } catch (error) {
                        console.error('Error adding location:', error);
                    }
                };

                // Function to initiate deletion
                const handleDeleteClick = (location) => {
                    setLocationToDelete(location);
                    setShowDeleteModal(true);
                };

                // Function to confirm and perform deletion
                const confirmDelete = async () => {
                    if (!locationToDelete) return;

                    try {
                        const response = await fetch(API_URL, {
                            method: 'DELETE',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ id: locationToDelete.id_ubicaciones_mesas })
                        });
                        const result = await response.json();
                        if (result.success) {
                            setShowDeleteModal(false);
                            setLocationToDelete(null);
                            fetchLocations(); // Refresh list
                        } else {
                            alert('Error: ' + result.message);
                            setShowDeleteModal(false);
                        }
                    } catch (error) {
                        console.error('Error deleting location:', error);
                    }
                };

                // Function to cancel deletion
                const cancelDelete = () => {
                    setShowDeleteModal(false);
                    setLocationToDelete(null);
                };


                const Sidebar = () => (
                    <aside className={`fixed top-0 left-0 z-40 w-64 h-screen bg-gray-900 transition-transform ${isSidebarOpen ? 'translate-x-0' : '-translate-x-full'} lg:translate-x-0`}>
                        <div className="h-full px-3 py-4 overflow-y-auto">
                            <div className="flex items-center justify-between mb-6">
                                <a href="#" className="flex items-center ps-2.5">
                                    <Icon name="UtensilsCrossed" className="h-6 w-6 me-3 text-cyan-400" />
                                    <span className="self-center text-xl font-semibold whitespace-nowrap text-white">Sistema</span>
                                </a>
                                <button onClick={() => setIsSidebarOpen(false)} className="lg:hidden p-2 rounded-md hover:bg-gray-700">
                                    <Icon name="X" className="w-6 h-6" />
                                </button>
                            </div>
                        
                            {/* User Profile */}
                            <div className="p-4 mb-4 bg-gray-800 rounded-lg">
                                <div className="flex items-center space-x-3">
                                    <div className="flex-shrink-0">
                                        <img className="w-10 h-10 rounded-full" src="https://placehold.co/40x40/7c3aed/ffffff?text=CB" alt="User" />
                                    </div>
                                    <div className="flex-1 min-w-0">
                                        <p className="text-sm font-semibold text-white truncate">
                                            Camilo B
                                        </p>
                                        <p className="text-xs text-gray-400 truncate">
                                            Administrador
                                        </p>
                                    </div>
                                </div>
                            </div>

                            {/* Menu */}
                            <p className="text-xs font-semibold text-gray-500 uppercase px-4 mt-6 mb-2">Menú</p>
                            <ul className="space-y-2 font-medium">
                                <li><a href="#" className="flex items-center p-2 text-gray-300 rounded-lg hover:bg-gray-700 group"><Icon name="Beer" className="w-5 h-5 text-gray-400 group-hover:text-white transition duration-75" /> <span className="ms-3">Cervezas</span></a></li>
                                <li><a href="#" className="flex items-center p-2 text-gray-300 rounded-lg hover:bg-gray-700 group"><Icon name="Wine" className="w-5 h-5 text-gray-400 group-hover:text-white transition duration-75" /> <span className="ms-3">Licores</span></a></li>
                                <li><a href="#" className="flex items-center p-2 text-gray-300 rounded-lg hover:bg-gray-700 group"><Icon name="GlassWater" className="w-5 h-5 text-gray-400 group-hover:text-white transition duration-75" /> <span className="ms-3">Refrescos</span></a></li>
                                <li><a href="#" className="flex items-center p-2 text-gray-300 rounded-lg hover:bg-gray-700 group"><Icon name="Cookie" className="w-5 h-5 text-gray-400 group-hover:text-white transition duration-75" /> <span className="ms-3">Snacks</span></a></li>
                                <li><a href="#" className="flex items-center p-2 text-gray-300 rounded-lg hover:bg-gray-700 group"><Icon name="ConciergeBell" className="w-5 h-5 text-gray-400 group-hover:text-white transition duration-75" /> <span className="ms-3">Otros</span></a></li>
                            </ul>
                            
                            {/* Administration */}
                            <p className="text-xs font-semibold text-gray-500 uppercase px-4 mt-6 mb-2">Administración</p>
                            <ul className="space-y-2 font-medium">
                                <li><a href="#" className="flex items-center p-2 text-white bg-gray-700 rounded-lg group"><Icon name="MapPin" className="w-5 h-5 text-cyan-400 transition duration-75" /> <span className="ms-3">Gestionar Ubicaciones</span></a></li>
                                <li><a href="#" className="flex items-center p-2 text-gray-300 rounded-lg hover:bg-gray-700 group"><Icon name="Package" className="w-5 h-5 text-gray-400 group-hover:text-white transition duration-75" /> <span className="ms-3">Volver a Productos</span></a></li>
                            </ul>
                        </div>
                    </aside>
                );

                const Header = () => (
                    <header className="bg-gray-900/80 backdrop-blur-sm sticky top-0 z-30 lg:hidden px-4 py-3 border-b border-gray-700">
                        <div className="flex items-center justify-between">
                            <button onClick={() => setIsSidebarOpen(true)} className="p-2 rounded-md hover:bg-gray-700">
                                <Icon name="Menu" className="w-6 h-6" />
                            </button>
                            <a href="#" className="flex items-center">
                                <Icon name="UtensilsCrossed" className="h-6 w-6 me-2 text-cyan-400" />
                                <span className="self-center text-lg font-semibold whitespace-nowrap text-white">Sistema</span>
                            </a>
                            <div className="p-2">
                                <Icon name="CircleUser" className="w-6 h-6" />
                            </div>
                        </div>
                    </header>
                );
                
                const DeleteModal = () => (
                    <div id="deleteModal" className={`fixed inset-0 z-50 flex items-center justify-center p-4 transition-opacity duration-300 ${showDeleteModal ? 'opacity-100' : 'opacity-0 pointer-events-none'}`}>
                        <div className="relative bg-gray-800 rounded-lg shadow-xl w-full max-w-md">
                            <div className="p-6 text-center">
                                <Icon name="TriangleAlert" className="mx-auto mb-4 h-14 w-14 text-red-500" />
                                <h3 className="mb-5 text-lg font-normal text-gray-300">
                                    ¿Estás seguro de que deseas eliminar la ubicación "{locationToDelete?.nombre_ubicacion}"?
                                </h3>
                                <button onClick={confirmDelete} type="button" className="text-white bg-red-600 hover:bg-red-700 focus:ring-4 focus:outline-none focus:ring-red-800 font-medium rounded-lg text-sm inline-flex items-center px-5 py-2.5 text-center me-2 transition-colors">
                                    Sí, eliminar
                                </button>
                                <button onClick={cancelDelete} type="button" className="text-gray-400 bg-transparent hover:bg-gray-700 hover:text-white focus:ring-4 focus:outline-none focus:ring-gray-600 rounded-lg border border-gray-600 text-sm font-medium px-5 py-2.5 transition-colors">
                                    No, cancelar
                                </button>
                            </div>
                        </div>
                    </div>
                );

                return (
                    <div className="flex h-screen bg-gray-900">
                        <Sidebar />
                        <div className="flex-1 flex flex-col overflow-hidden lg:ml-64">
                            <Header />
                            <main className="flex-1 overflow-x-hidden overflow-y-auto bg-gray-800">
                                <div className="container mx-auto px-6 py-8">
                                    <h1 className="text-3xl font-bold text-white mb-6">Gestionar Ubicaciones de Mesas</h1>

                                    {/* Add New Location Form */}
                                    <div className="bg-gray-900 p-6 rounded-lg shadow-md mb-8">
                                        <h2 className="text-xl font-semibold text-white mb-4">Agregar Nueva Ubicación</h2>
                                        <form onSubmit={handleAddLocation}>
                                            <div className="flex flex-col sm:flex-row gap-4">
                                                <input
                                                    type="text"
                                                    value={newLocationName}
                                                    onChange={(e) => setNewLocationName(e.target.value)}
                                                    placeholder="Nombre de la nueva ubicación"
                                                    className="flex-grow bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-cyan-500 focus:border-cyan-500 block w-full p-3 transition"
                                                />
                                                <button
                                                    type="submit"
                                                    className="text-white bg-cyan-600 hover:bg-cyan-700 focus:ring-4 focus:outline-none focus:ring-cyan-800 font-medium rounded-lg text-sm px-6 py-3 text-center transition-colors flex items-center justify-center gap-2"
                                                >
                                                    <Icon name="PlusCircle" className="w-5 h-5" />
                                                    Guardar
                                                </button>
                                            </div>
                                        </form>
                                    </div>

                                    {/* Existing Locations List */}
                                    <div className="bg-gray-900 p-6 rounded-lg shadow-md">
                                        <h2 className="text-xl font-semibold text-white mb-4">Ubicaciones Existentes</h2>
                                        <div className="space-y-4">
                                            {locations.length > 0 ? (
                                                locations.map(location => (
                                                    <div key={location.id_ubicaciones_mesas} className="bg-gray-800 p-4 rounded-lg flex items-center justify-between transition-all hover:bg-gray-700/50">
                                                        <span className="text-gray-200 font-medium">{location.nombre_ubicacion}</span>
                                                        <div className="flex items-center gap-3">
                                                            <button className="flex items-center gap-1.5 text-sm text-blue-400 hover:text-blue-300 transition-colors font-medium p-2 rounded-md hover:bg-blue-500/10">
                                                                <Icon name="PenSquare" className="w-4 h-4" />
                                                                Editar
                                                            </button>
                                                            <button 
                                                                onClick={() => handleDeleteClick(location)}
                                                                className="flex items-center gap-1.5 text-sm text-red-400 hover:text-red-300 transition-colors font-medium p-2 rounded-md hover:bg-red-500/10"
                                                            >
                                                                <Icon name="Trash2" className="w-4 h-4" />
                                                                Eliminar
                                                            </button>
                                                        </div>
                                                    </div>
                                                ))
                                            ) : (
                                                <div className="text-center py-8 text-gray-500">
                                                    <Icon name="Inbox" className="w-12 h-12 mx-auto mb-2" />
                                                    <p>No hay ubicaciones registradas.</p>
                                                    <p className="text-sm">Agrega una usando el formulario de arriba.</p>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            </main>
                        </div>
                        <DeleteModal />
                    </div>
                );
            }

            ReactDOM.render(<App />, document.getElementById('root'));
        }
    </script>

</body>
</html>